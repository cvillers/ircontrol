{"version":3,"sources":["controllers/controller.ts"],"names":["ControllerController","ControllerController.constructor","ControllerController.PushButton"],"mappings":"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","file":"controllers/controller.js","sourcesContent":["/// <reference path=\"../angular.d.ts\" />\n/// <reference path=\"../services/buttons.ts\" />\n\n/*\nController for the main button-pusher.\n*/\n\ninterface IControllerScope extends ng.IScope\n{\n\tControlState: {\n\t\tPower: boolean;\n\t\tMode: FanMode\n\t};\n\tButtons: { [ id: string ]: Button };\n\t\n\tPushButton : (name: string) => void;\n}\n\nclass ControllerController\n{\n\tprivate _scope: IControllerScope;\n\tprivate _log: ng.ILogService;\n\tprivate _buttonService: IButtonService;\n\n\tprivate _buttons: Button[];\n\tprivate _buttonMap: { [ id: string ]: Button };\n\n\tpublic constructor(scope: IControllerScope, logService: ng.ILogService, buttonService: IButtonService)\n\t{\n\t\tvar self = this;\n\n\t\tthis._scope = scope;\n\t\tthis._log = logService;\n\t\tthis._buttonService = buttonService;\n\t\t\n\t\t//this._buttons = buttonService.GetButtons();\n\t\tthis._buttonMap = {};\n\t\tthis._buttonService.GetButtons().then(buttons =>\n\t\t\t{\n\t\t\t\tself._buttons = buttons;\n\t\t\t\tangular.forEach(self._buttons, (br : Button) =>\n\t\t\t\t{\n\t\t\t\t\tself._buttonMap[br.Id] = br;\n\t\t\t\t});\n\t\t\t\tself._scope.Buttons = self._buttonMap;\n\t\t\t},\n\t\t\treason =>\n\t\t\t{\n\t\t\t\t// TODO display error to user\n\t\t\t\tthis._scope.Buttons = {};\n\t\t\t});\n\t\t\n\t\tthis._scope.ControlState = { Power: buttonService.GetPowerState(), Mode: buttonService.GetFanMode() };\n\t\t\n\t\t//this._scope.PushButton = n => this._buttonService.PushButton(this._buttonMap[n]);\n\t\t//this._scope.PushButton = this.PushButton;\n\t\tthis._scope.PushButton = n => this.PushButton(self, n);\n\t\t\n\t\tthis._scope.$watch(s => (<IControllerScope>s).ControlState.Power, (n, o, s) => buttonService.SetPowerState(n));\n\n\t\tthis._scope.$watch(s => (<IControllerScope>s).ControlState.Mode, (n, o, s) => buttonService.SetFanMode(n));\n\t}\n\t\n\t/**\n\t * Handler for a button push.\n\t */\n\tprivate PushButton(self: ControllerController, name: string) : void\n\t{\n\t\tself._buttonService.PushButton(this._buttonMap[name]).then(v =>\n\t\t\t{\n\t\t\t\tthis._log.info(\"Pushed button \" + name + \" successfully\");\n\t\t\t},\n\t\t\treason =>\n\t\t\t{\n\t\t\t\tvar msg = \"Could not push button \" + name + \": \" + reason;\n\t\t\t\talert(angular.toJson(msg));\n\t\t\t\tthis._log.warn(msg);\n\t\t\t});\n\t}\n}\n\nangular.module(\"IRControlApp\").controller(\"ControllerController\", [\"$scope\", \"$log\", \"IRButtons\", ControllerController]);\n"],"sourceRoot":"/source/"}